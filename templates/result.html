<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Summary Result</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css" rel="stylesheet">

  <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>

  <style>
    body {
      background: #f8f9fa;
    }

    table {
      font-size: 13px;
    }
  </style>
</head>

<body class="container-fluid mt-3">

  <h4 class="mb-3">Alarms Summary</h4>

  <!-- Tabs -->
  <ul class="nav nav-tabs mb-3">
    <li class="nav-item">
      <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#downTab">
        Down Alarms
      </button>
    </li>
    <li class="nav-item">
      <button class="nav-link" data-bs-toggle="tab" data-bs-target="#envTab">
        ENV Alarms
      </button>
    </li>
    <li class="nav-item">
      <button class="nav-link" data-bs-toggle="tab" data-bs-target="#criticalEnvTab">
        Critical ENV
      </button>
    </li>
  </ul>

  <div class="tab-content">

    <!-- DOWN TAB -->
    <div class="tab-pane fade show active" id="downTab">
      {% if tables_down_env|length > 0 %}
      <input id="downSearch" class="form-control form-control-sm mb-2" placeholder="Search Down Alarms">

      <table id="downTable" class="table table-striped table-bordered">
        <thead>
          <tr>
            {% for key in tables_down_env[0].keys() %}
            <th>{{ key }}</th>
            {% endfor %}
          </tr>
        </thead>
        <tbody>
          {% for row in tables_down_env %}
          <tr>
            {% for val in row.values() %}
            <td>{{ val|safe }}</td>
            {% endfor %}
          </tr>
          {% endfor %}
        </tbody>
      </table>
      {% else %}
      <div class="alert alert-info">No Down Alarms</div>
      {% endif %}
    </div>

    <!-- ENV TAB -->
    <div class="tab-pane fade" id="envTab">
      {% if tables_env_only|length > 0 %}
      <input id="envSearch" class="form-control form-control-sm mb-2" placeholder="Search ENV Alarms">

      <select id="envAlarmFilter" class="form-select form-select-sm mb-2" multiple></select>

      <table id="envTable" class="table table-striped table-bordered">
        <thead>
          <tr>
            {% for key in tables_env_only[0].keys() %}
            <th>{{ key }}</th>
            {% endfor %}
          </tr>
        </thead>
        <tbody>
          {% for row in tables_env_only %}
          <tr>
            {% for val in row.values() %}
            <td>{{ val|safe }}</td>
            {% endfor %}
          </tr>
          {% endfor %}
        </tbody>
      </table>
      {% else %}
      <div class="alert alert-info">No ENV Alarms</div>
      {% endif %}
    </div>

    <!-- CRITICAL ENV TAB -->
    <div class="tab-pane fade" id="criticalEnvTab">
      {% if critical_env_table|length > 0 %}
      <input id="crenvSearch" class="form-control form-control-sm mb-2" placeholder="Search Critical ENV">

      <table id="crenvTable" class="table table-striped table-bordered">
        <thead>
          <tr>
            {% for key in critical_env_table[0].keys() %}
            <th>{{ key }}</th>
            {% endfor %}
          </tr>
        </thead>
        <tbody>
          {% for row in critical_env_table %}
          <tr>
            {% for val in row.values() %}
            <td>{{ val|safe }}</td>
            {% endfor %}
          </tr>
          {% endfor %}
        </tbody>
      </table>
      {% else %}
      <div class="alert alert-info">No Critical ENV Alarms</div>
      {% endif %}
    </div>

  </div>

  <script>
    $(document).ready(function () {

      // DOWN TABLE
      var downTable = $('#downTable').DataTable({
        paging: true,
        autoWidth: false,
        columnDefs: [{ targets: [3, 4, 5, 6, 10], visible: false }]
      });
      $('#downSearch').on('keyup', function () {
        downTable.search(this.value).draw();
      });

      // ENV TABLE
      var envTable = $('#envTable').DataTable({
        paging: true,
        autoWidth: false,
        columnDefs: [{ targets: [3, 4, 5, 6, 10], visible: false }]
      });
      $('#envSearch').on('keyup', function () {
        envTable.search(this.value).draw();
      });

      // ENV Alarm Filter (Column index ثابت)
      var envColIndex = 2;
      var uniqueEnv = new Set();

      envTable.column(envColIndex).data().each(function (d) {
        uniqueEnv.add(d);
      });

      uniqueEnv.forEach(function (v) {
        $('#envAlarmFilter').append(`<option value="${v}">${v}</option>`);
      });

      $('#envAlarmFilter').on('change', function () {
        var vals = $(this).val();
        if (!vals || vals.length === 0) {
          envTable.column(envColIndex).search('').draw();
        } else {
          envTable.column(envColIndex).search(vals.join('|'), true, false).draw();
        }
      });

      // CRITICAL ENV TABLE
      var crenvTable = $('#crenvTable').DataTable({
        paging: true,
        autoWidth: false,
        columnDefs: [{ targets: [3, 4, 5, 6, 10], visible: false }]
      });
      $('#crenvSearch').on('keyup', function () {
        crenvTable.search(this.value).draw();
      });

    });
  </script>

</body>

</html>